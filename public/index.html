<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Asylumgram PRO</title>
<script src="/socket.io/socket.io.js"></script>

<style>
body{
margin:0;
font-family:Arial;
background:#0f0f0f;
color:white;
height:100vh;
display:flex;
}

#auth{
position:absolute;
width:100%;
height:100%;
display:flex;
flex-direction:column;
justify-content:center;
align-items:center;
background:#0f0f0f;
}

#auth input{
padding:10px;
margin:5px;
border:none;
border-radius:8px;
width:200px;
}

#auth button{
padding:10px 15px;
border:none;
border-radius:8px;
background:#00c853;
color:white;
cursor:pointer;
}

#app{
display:none;
width:100%;
}

#sidebar{
width:230px;
background:#1a1a1a;
padding:10px;
overflow-y:auto;
}

#chat{
flex:1;
display:flex;
flex-direction:column;
}

#header{
padding:15px;
background:#1f1f1f;
}

#messages{
flex:1;
overflow-y:auto;
padding:10px;
display:flex;
flex-direction:column;
}

.message{
max-width:70%;
margin:5px 0;
padding:8px 12px;
border-radius:15px;
word-wrap:break-word;
}

.me{background:#00c853;align-self:flex-end;}
.other{background:#262626;align-self:flex-start;}

#bottom{
display:flex;
padding:10px;
background:#1f1f1f;
}

#input{
flex:1;
padding:10px;
border:none;
border-radius:20px;
background:#2a2a2a;
color:white;
}

button{
margin-left:5px;
border:none;
padding:8px 12px;
border-radius:20px;
background:#00c853;
color:white;
cursor:pointer;
}

.user{
padding:6px;
cursor:pointer;
border-radius:6px;
}

.user:hover{
background:#2a2a2a;
}
</style>
</head>

<body>

<div id="auth">
<h2>Asylumgram PRO</h2>
<input id="userInput" placeholder="–ù–∏–∫">
<input id="passInput" type="password" placeholder="–ü–∞—Ä–æ–ª—å">
<button onclick="register()">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
<button onclick="login()">–í—Ö–æ–¥</button>
<div id="error" style="color:red;"></div>
</div>

<div id="app">

<div id="sidebar">
<div onclick="openGlobal()">üåç –ì–ª–æ–±–∞–ª</div>
<hr>
<div id="users"></div>
</div>

<div id="chat">
<div id="header">
<span id="chatTitle">–ì–ª–æ–±–∞–ª</span>
</div>
<div id="messages"></div>
<div id="bottom">
<input id="input" placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ...">
<button onclick="send()">‚û§</button>
</div>
</div>

</div>

<script>
const socket = io();
let username = null;
let currentType = "global";

const userInput = document.getElementById("userInput");
const passInput = document.getElementById("passInput");
const errorDiv = document.getElementById("error");
const authDiv = document.getElementById("auth");
const appDiv = document.getElementById("app");
const input = document.getElementById("input");
const messages = document.getElementById("messages");
const usersDiv = document.getElementById("users");

function register(){
if(!userInput.value || !passInput.value){
errorDiv.innerText="–í–≤–µ–¥–∏—Ç–µ –Ω–∏–∫ –∏ –ø–∞—Ä–æ–ª—å";
return;
}

socket.emit("register",
{username:userInput.value,password:passInput.value},
res=>{
if(res.success){
alert("–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞");
errorDiv.innerText="";
}else{
errorDiv.innerText=res.message;
}
});
}

function login(){
if(!userInput.value || !passInput.value){
errorDiv.innerText="–í–≤–µ–¥–∏—Ç–µ –Ω–∏–∫ –∏ –ø–∞—Ä–æ–ª—å";
return;
}

socket.emit("login",
{username:userInput.value,password:passInput.value},
res=>{
if(res.success){
username=userInput.value;
authDiv.style.display="none";
appDiv.style.display="flex";
}else{
errorDiv.innerText=res.message;
}
});
}

function openGlobal(){
messages.innerHTML="";
}

socket.on("users",list=>{
usersDiv.innerHTML="";
list.forEach(u=>{
if(u!==username){
const d=document.createElement("div");
d.className="user";
d.innerText=u;
usersDiv.appendChild(d);
}
});
});

function send(){
if(!username) return;

const text=input.value.trim();
if(!text) return;

const msg={from:username,type:"text",content:text};
socket.emit("send_global",msg);
input.value="";
}

function add(msg){
const div=document.createElement("div");
div.classList.add("message");
div.classList.add(msg.from===username?"me":"other");
div.innerText=msg.from+": "+msg.content;
messages.appendChild(div);
messages.scrollTop=messages.scrollHeight;
}

socket.on("new_global",msg=>{
add(msg);
});
</script>

</body>
</html>